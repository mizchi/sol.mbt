///|
/// Asset embedding helpers for Sol SSG
/// Functions to embed CSS and JavaScript into HTML

///|
/// Get combined CSS with theme customization
pub fn get_default_css(config : @ssg.SsgConfig) -> String {
  // Use main.css default Indigo colors, allow override via config
  let base_css = get_main_css()
  if base_css.is_empty() {
    // Fallback to inline CSS if file not found
    let primary_light = config.theme.primary_color.unwrap_or("#6366f1") // Indigo 500
    let primary_dark = config.theme.primary_color.unwrap_or("#818cf8") // Indigo 400
    get_fallback_css(primary_light, primary_dark)
  } else {
    // If config has custom primary color, replace default Indigo with custom
    match config.theme.primary_color {
      Some(custom_color) =>
        base_css
        .replace(
          old="--primary-color: #6366f1",
          new="--primary-color: \{custom_color}",
        )
        .replace(
          old="--primary-color: #818cf8",
          new="--primary-color: \{custom_color}",
        )
      None => base_css // Use default Indigo colors from main.css
    }
  }
}

///|
/// Get GitHub markdown CSS
pub fn get_github_markdown_css() -> String {
  let css = get_markdown_css()
  if css.is_empty() {
    get_fallback_markdown_css()
  } else {
    css
  }
}

///|
/// Get theme toggle script (early load to prevent flash)
pub fn get_theme_script() -> String {
  let js = get_theme_js()
  if js.is_empty() {
    get_fallback_theme_script()
  } else {
    js
  }
}

///|
/// Get sidebar state persistence script (wrapped in script tags)
pub fn get_sidebar_script() -> String {
  let js = get_sidebar_js()
  if js.is_empty() {
    get_fallback_sidebar_script()
  } else {
    "<script>\n\{js}\n</script>"
  }
}

///|
/// Get TOC scroll spy script (wrapped in script tags)
pub fn get_toc_script() -> String {
  let js = get_toc_js()
  if js.is_empty() {
    get_fallback_toc_script()
  } else {
    "<script>\n\{js}\n</script>"
  }
}

///|
/// Get Web Components loader script (wrapped in script tags)
pub fn get_wc_loader_script() -> String {
  let js = get_wc_loader_js()
  if js.is_empty() {
    get_fallback_wc_loader_script()
  } else {
    "<script>\n\{js}\n</script>"
  }
}

///|
/// Get island loader script
pub fn get_island_loader_js() -> String {
  let js = get_loader_js()
  if js.is_empty() {
    get_fallback_loader_js()
  } else {
    js
  }
}

// Fallback functions for when external files are not available
// These contain the minimal necessary CSS/JS

///|
fn get_fallback_css(primary_light : String, primary_dark : String) -> String {
  "/* Luna SSG Default Theme - Fallback */\n:root { --primary-color: \{primary_light}; --text-color: #1f2937; --bg-color: #fff; }\nhtml.dark { --primary-color: \{primary_dark}; --text-color: #f3f4f6; --bg-color: #0f0f0f; }"
}

///|
fn get_fallback_markdown_css() -> String {
  "/* Markdown fallback */\n.markdown-body { font-family: sans-serif; line-height: 1.5; }"
}

///|
fn get_fallback_theme_script() -> String {
  let script =
    #|(function(){
    #|  var theme = localStorage.getItem('theme');
    #|  if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    #|    document.documentElement.classList.add('dark');
    #|  }
    #|  window.toggleTheme = function() {
    #|    var html = document.documentElement;
    #|    html.classList.toggle('dark');
    #|    localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    #|  };
    #|})();
  script
}

///|
fn get_fallback_sidebar_script() -> String {
  "<script>(function(){ window.__SOL_INIT_SIDEBAR__ = function(){}; })();</script>"
}

///|
fn get_fallback_toc_script() -> String {
  "<script>(function(){ window.__SOL_INIT_TOC_SPY__ = function(){}; })();</script>"
}

///|
fn get_fallback_wc_loader_script() -> String {
  "<script>(function(){ window.__LUNA_WC_SCAN__ = function(){}; window.__LUNA_WC_CLEAR_LOADED__ = function(){}; })();</script>"
}

///|
fn get_fallback_loader_js() -> String {
  "(function(){ window.__LUNA_STATE__ = {}; window.__LUNA_SCAN__ = function(){}; })();"
}
